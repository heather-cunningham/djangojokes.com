{% extends "_base.html" %}
{% load static %}

{% block javascript %}
<!-- Sets constants used in jokes.js. These vars are set in the template so you can get
  a dynamic URL based on the slug of the Joke instance. -->
  <script>
    const ajaxURL = "{% url 'jokes:ajax-vote' joke.slug %}";
    // const isAuthenticated = {{ user.is_authenticated|lower }};
  </script>
<!-- Uses the `static` Django template tag to get the path to js/jokes.js, 
 but it only works if static dir has been loaded like a lib or pkg.  
 See Django template load tag above. -->
  <script src="{% static 'js/jokes.js' %}"></script>
{% endblock %}

{% block title %}
  Joke
{% endblock %}

{% block main %}
<div class="card border-primary m-auto mb-3 text-center" style="max-width: 30rem">
  <!-- The template has access to an auto-created variable called "joke" (the lowercase model name),
    containing the joke object. -->
  <div id="joke-{{joke.id}}-question" class="card-header">
    {{ joke.question }}
  </div>

  <div id="joke-{{joke.id}}-punchline" class="card-body text-primary">
    <h5 class="card-title">{{ joke.answer }}</h5>
  </div>

  <div id="joke-{{joke.id}}-footer" class="card-footer">
    <div id="joke-{{joke.id}}-cats-tags" class="border-bottom border-faded pb-2">
      <span id="joke-{{joke.id}}-category">
        <strong>Category:</strong> {{ joke.category.category }}<br>
      </span>
      {% for tag in joke.tags.all %}
        <span id="joke-{{joke.id}}-tag-{{tag.id}}" 
          class="badge rounded-pill bg-secondary">{{ tag.tag }}</span>
      {% endfor %}
    </div>

    
      <div class="border-bottom border-faded m-2 pb-2">
        {% if joke.user == user %}
          <a id="update-joke-{{joke.id}}-btn" href="{% url 'jokes:update' joke.slug %}" 
            class="btn btn-info btn-sm me-2">Update</a>
          <a id="delete-joke-{{joke.id}}-btn" href="{% url 'jokes:delete' joke.slug %}" 
            class="btn btn-danger btn-sm me-2">Delete</a>

          <p>
            Your joke has <span id="num-votes">{{ joke.num_votes|default:'no' }} vote{{ joke.num_votes|pluralize }}.</span>
            {% if joke.num_votes %}
              It has <span id="likes">{{ joke.num_likes }} like{{ joke.num_likes|pluralize }}</span> and
              <span id="dislikes">{{ joke.num_dislikes }} dislike{{ joke.num_dislikes|pluralize }}.</span>
            {% endif %}
          </p>
        {% else %}
          {% csrf_token %}
          <button id="dislike-button" class="btn btn-light" type="button">
            <i class="fas fa-thumbs-down fa-2x text-danger mx-3"></i><span id="dislikes">{{ joke.num_dislikes }}</span>
          </button>
          <button id="like-button" class="btn btn-light" type="button">
            <i class="fas fa-thumbs-up fa-2x text-success mx-3"></i><span id="likes">{{ joke.num_likes }}</span>
          </button>

          <div id="output" class="text-info"></div>
          <span id="num-votes">{{ joke.num_votes }} vote{{ joke.num_votes|pluralize }}</span>
        {% endif %}
      </div>
    
      <small class="text-muted">
        {% if joke.user.avatar %}
          <img id="author-avatar-pic" src="{{ joke.user.avatar.url }}" class="mt-1 rounded float-end" 
            alt="Author's avatar or profile picture"/>
        {% endif %}


        <span id="joke-{{joke.id}}-created"><span class="createdby-label">Created on: </span>
          {{ joke.created }}</span>
        <br />
        <span id="joke-{{joke.id}}-createdby"><span class="createdby-label">By: </span>
          {{ joke.user.username }}</span>
        <br />
        <span id="joke-{{joke.id}}-updated"><span class="createdby-label">Last updated:</span> 
          {{ joke.updated }}</span>
      </small>
    
  </div>
</div>
{% endblock %}